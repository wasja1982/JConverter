JConverter 0.5
=============================
Конвертор бекапа Ucoz в [AtomM CMS](http://atom-m.net)

Возможности
-----------

1. Перенос пользователей (основные настройки, информация о банах и активации, аватары). Пароли пользователей не сохраняются. ID пользователей соответствуют Ucoz. Получение аватаров может осуществляться из сети Internet (по умолчанию отключено).
2. Конвертация форума (разделы, подразделы, темы, сообщения и вложения).
3. Конвертация новостей, блогов и FAQ (категории, материалы и вложения) в модуль "Новости". 
4. Конвертация статей (категории, статьи и вложения). Ссылка на источник материала сохраняется в дополнительном поле.
5. Конвертация каталога файлов (категории и файлы). Ссылка для скачивания с другого сервера сохраняется в дополнительном поле (для версии старше 1.2 beta) или импортируется в базу (с 1.2 beta и новее).
6. Парсинг смайлов. По умолчанию отключен (смайлы отображаются в виде рисунков, загружающихся с серверов Ucoz), поскольку набор смайлов AtomX не соответствует Ucoz.
7. Конвертация комментариев для блогов, новостей, статей и каталога файлов.
8. Возможность парсинга отдельных модулей.
9. Возможность разбиения скриптов на отдельные функциональные части (для больших сайтов).
10. Реализована поддержка следующих кодов Ucoz:
  1. `[b]Жирный текст[/b]` - полностью
  2. `[i]Наклонный текст[/i]` - полностью
  3. `[s]Зачеркнутый текст[/s]` - полностью
  4. `[u]Подчеркнутый текст[/u]` - полностью
  5. `[o]Черта вверху текста[/o]` - не реализован, не поддерживается AtomX
  6. `[l]Текст по левому краю[/l]` - полностью
  7. `[c]Текст по центру[/c]` - полностью
  8. `[r]Текст по правому краю[/r]` - полностью
  9. `[j]Текст по ширине страницы[/j]` - не реализован, не поддерживается AtomX
  10. `[sub]Нижний индекс[/sub]` - не реализован, не поддерживается AtomX
  11. `[sup]Верхний индекс[/sup]` - не реализован, не поддерживается AtomX
  12. `[size=10]Размер шрифта[/size]` - реализован в режиме совместимости с AtomX (размеры 10, 15, 20, 25)
  13. `[color=red]Цвет шрифта[/color]` - реализован в режиме совместимости с AtomX (поддерживает не все цвета)
  14. `[font=Comic Sans MS]Другой шрифт[/font]` - не реализован, не поддерживается AtomX
  15. `[hide]Any text goes here...[/hide]` - полностью
  16. `[spoiler]Any text goes here...[/spoiler]` - полностью
  17. `[spoiler=Title]Any text goes here...[/spoiler]` - реализован частично, не поддерживается AtomX
  18. `[video]http://youtube.com/watch?v=DbzFNj8HVmc[/video]` - полностью
  19. `[audio]http://any_site.com/music.mp3[/audio]` - реализован, не поддерживается AtomX
  20. `[code ]Код программы[/code ]` - полностью
  21. `[quote]Цитата из сообщения[/quote]` - полностью
  22. `[quote=Alex]Цитата из сообщения[/quote]` - полностью
  23. `[hr]` - не реализован, не поддерживается AtomX
  24. `[url]http://www.ucoz.net[/url]` - полностью
  25. `[url=http://www.ucoz.net]uCoz[/url]` - полностью
  26. `[email]your@mail.com[/email]` - не реализован, не поддерживается AtomX
  27. `[email=your@mail.com]Contact Us[/email]` - не реализован, не поддерживается AtomX
  28. `[img]http://www.site.com/img.gif[/img]` - полностью
  29. `[list][*]пункт 1[*]пункт 2[/list]` - полностью
  30. `[*]пункт 1[*]пункт 2` - не реализован, не поддерживается AtomX
  31. `(c)` - полностью
  32. `(r)` - полностью
  33. `(tm)` - полностью

Изменения в версиях
-------------------

### JConverter 0.0 (05.01.2011):

* Полный функциональный аналог php-конвертора.

### JConverter 0.1 (07.01.2011):

* Добавлен парсинг HTML в BB-коды.

### JConverter 0.2 (08.01.2011):

* Добавлена генерация запросов на очистку изменяемых таблиц БД.
* Добавлена поддержка вложений на форуме, в том числе обработка изображений.
* Устранена проблема с "последними сообщениями" на форуме.
* Устранена проблема с лишними пробелами.
* Добавлена конвертация аватаров пользователей.

### JConverter 0.3 (11.01.2011):

* Устранена проблема с категориями статей и новостей (ошибка генерация секций).
* Нумерация пользователей (ID) приведена в соотвествие с Ucoz.
* Интегрирована загрузка аватаров из сети Internet.
* Добавлен каталог файлов (не выводятся на главную).
* Переносится информация о наличии бана (в том числе из группы "Заблокированные" с ID=255).
* Устранена проблема с "последним посещением" пользователей.
* Переноситься информация о неактивированных пользователях.
* Переработан алгоритм парсинга файлов бекапов (добавлена поддержка многострочных полей).
* Исправлен алгоритм работы со статьями (выводятся на главную).
* Исправлен алгоритм работы с новостями (выводятся на главную, категория "Новости" ).
* Добавлено экспортирование блогов и FAQ (выводятся на главную, категория "Новости" ).
* Добавлена конвертация смайлов (не соотвествует стандартному набору AtomX).
* Добавлена конвертация комментариев для блогов, новостей, статей и каталога файлов.
* Добавлены расширенные параметры командной строки.

### JConverter 0.3.1 (14.01.2011):

* Оптимизирован алгоритм парсинга файлов бекапа (добавлен анализ минимального количества требуемых полей).

### JConverter 0.3.2 (23.01.2011):

* Изменен путь к каталогу файлов (load/loads) для Fapos 0.9.93.

### JConverter 0.3.3 (09.06.2011):

* Модификация для совместимости с Fapos 1.0/1.1:
* Добавлен ключ для совместимости с предыдущими версиями.
* Добавлена конвертация описания тем форума.

### JConverter 0.3.4 (20.06.2011):

* Исправлена обработка изображений в вложениях на форуме (многократное повторение одного рисунка).
* Добавлен парсинг BB-кода [video].
* Добавлен парсинг BB-кода [audio].
* Исправлен алгоритм парсинга HTML (улучшен разбор ошибочных тегов, возможно отключение ключем "nofix" ).

### JConverter 0.3.5 (10.06.2012):

* Модификация для совместимости с версиями Fapos до 2.0 dev.
* Добавлен импорт даты рождения, города и поля для пользователей.
* Добавлен парсинг вложений в статьях, новостях, блогах и FAQ.
* Добавлен импорт даты и пользователя для комментариев.
* Добавлен импорт ссылки с удаленного сервера для материалов каталога файлов.

### JConverter 0.3.6 (15.03.2014):

* Модификация для совместимости с версиями Fapos 2.1 RC7 (единая таблица для комментариев).
* Модификация для совместимости с версиями Fapos 2.2 RC1 (поддержка премодерации материалов).
* Модификация для совместимости с версиями Fapos 2.4 RC5 (поддержка путей для категорий).
* Модификация для совместимости с версиями AtomX 2.5 RC1 / AtomM 3 (поддержка премодерации комментариев).

### JConverter 0.4 (04.02.2016):

* Модификация для совместимости с версиями AtomM 4.

### JConverter 0.5:

* Модификация для совместимости с версиями AtomM 5.
* Изменен порядок загрузки данных из бекапа (данные хранятся в памяти).
* Добавлен усовершенствонный алгоритм парсинга ссылок (учитывает, что на Ucoz используются только http-доступ).
* Отслеживание необходимости закачки аватар по имени сайта.
* Улучшена поддержка "внешних ссылок" в каталоге файлов. Файлы, лежащие на сайте также переносятся.
* Добавлена сортировка материалов по ID.
* Анализ наличия "http://" и "www." в старом имени сайта, наличия "http://" или "https://" в новом имени сайта.
* Парсинг ссылок с учетом ЧПУ вида "/publ/razdel_1/kategorija_1_2/nazvanie_materiala/5-1-0-11".
* Добавлен перенос статусов пользователя.

Использование
-------------

1. Для работы необходима [установленная Java-машина](http://atomx.net/forum/view_post/2395).
2. Параметры командной строки:
  1. Общие параметры:
    * `-path path` - путь к папке бекапа; по умолчанию равен каталогу запуска; если путь содержит пробелы, то его необходимо взять в кавычки; указывается без завершающего слеша;
    * `-pref pref` - префикс БД, по умолчанию - без префикса;
    * `-pass password` - установить пароль пользователю с ID = 1;
    * `-so "sitename"` - старые доменные имена сайта в формате site.ucoz.ru или site.ru (без www. и указания протокола), разделенные точкой с запятой (например, "site.ucoz.ru;site.ru");
    * `-sn "sitename"` - новое имя сайта (допустимо использовать www. и протокол);
    * `-pof count` - число сообщений на форуме (используется при генерации ссылок на пост для Fapos 1.3 RC и старше).
  2. Выбор конвертируемых модулей (по умолчанинию конвертируются все):
    * `-users` - включить обработку пользователей;
    * `-forum` - включить обработку форума;
    * `-loads` - включить обработку файлового архива;
    * `-publ` - включить обработку статей;
    * `-news` - включить обработку новостей, блогов и FAQ;
    * `-comments` - включить обработку комментариев.
  3. Режимы работы:
    * `-split` - запись SQL-запросов в отдельные файлы;
    * `-wa` - разрешить загрузку аватаров из сети Internet;
    * `-wl` - разрешить загрузку отсутствующих файлов для файлового архива из сети Internet;
    * `-noempty` - отключить генерацию очистки таблиц;
    * `-noimage` - отключить конвертацию изображений в форуме (с версии 0.3.5 - в форуме, статьях, новостях, блогах и FAQ);
    * `-smile` - конвертировать смайлы;
    * `-nofix` - отключить разбор ошибочных тегов (ускоряет обработку);
    * `-nogroups` - отключить изменение групп пользователей (по умолчанию все пользователи групп с номерами больше 4 автоматически переносятся в группу "Пользователи").
  4. Режимы совместимости:
    * `-v0`- запуск в режиме совместимости с Fapos 0.9.93;
    * `-v1`- запуск в режиме совместимости с Fapos 1.0/1.1;
    * `-v2`- запуск в режиме совместимости с Fapos 1.1.8 beta;
    * `-v3`- запуск в режиме совместимости с Fapos 1.1.9;
    * `-v4`- запуск в режиме совместимости с Fapos 1.2 beta;
    * `-v5`- запуск в режиме совместимости с Fapos 1.3 RC;
    * `-v6`- запуск в режиме совместимости с Fapos 2.1 RC7;
    * `-v7`- запуск в режиме совместимости с Fapos 2.2 RC1;
    * `-v8`- запуск в режиме совместимости с Fapos 2.4 RC5;
    * `-v9`- запуск в режиме совместимости с AtomX 2.5 RC1 / AtomM 3;
    * `-v10`- запуск в режиме совместимости с AtomM 4;
    * `-v11`- запуск в режиме совместимости с AtomM 5 (по умолчанию).
3. Пример запуска:
  1. запуск из каталога бекапа, таблицы без префикса, конвертируются все таблицы:
  
      `@java -jar "JConverter.jar"`
  
  2. с путем к каталогу бекапа:
  
      `@java -jar "JConverter.jar" -path ucozDUMP`
  
  3. с путем к каталогу бекапа и заданным префиксом таблицы:
  
      `@java -jar "JConverter.jar" -path ucozDUMP -pref fps_`
  
  4. с путем к каталогу бекапа и генерацией отдельных файлов:
  
      `@java -jar "JConverter.jar" -path ucozDUMP -split`
  
  5. с путем к каталогу бекапа и загрузкой недостающих аватаров из сети Internet:
  
      `@java -jar "JConverter.jar" -path ucozDUMP -wa`
  
4. После успешного выполнение в каталоге запуска формируются:

* файл "atomm.sql" (по умалчанию) либо набор файлов вида "atomm_*.sql" (при использовании режима "-split" ); файлы содержат SQL-код, который необходимо выполнить на сервере;
* каталог "files", который необходимо скопировать в каталог "\data\" на сервере (для версий Fapos/AtomX - в каталог "\sys\");
* каталог "images", который необходимо скопировать в каталог "\data\" на сервере (только для AtomM 5 и новее);
* каталог "avatars", который необходимо скопировать в каталог "\data\" на сервере (для версий Fapos/AtomX - в каталог "\sys\");
* другие файлы и каталоги (в случае наличия в бекапе как ссылок на файлы, так и самих файлов), которые необходимо перенести в корень сайта.
